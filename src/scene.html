<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>My first Three.js app</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
		<script src="js/three.min.js"></script>
		<script src="js/lights/DirectionalLight.js"></script>

		<script>
			// Global variables
			var snakeCubeArray = [];
			var snakeForwardDirection = new THREE.Vector3(1,0,0);
			var clock = new THREE.Clock(true);
			var elapsedTime = 0;
			var tickDelta = 0.5 // 500ms

			// Debug or not
			var debug = false;

			// Create the scene
			var scene = new THREE.Scene();

			// Add the camera
			var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
			camera.position.set(0, -30, 30);
			camera.lookAt(scene.position);
			scene.add(camera); 


			// Add scene elements
			addSceneElements();

			// Add Snake
			initializeSnake();

			// Add lights
			addLights();

			// Create the WebGL renderer
			var renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );
			renderer.shadowMapEnabled = true;

			// Append the renderer to the body
			document.body.appendChild( renderer.domElement );

			document.onkeydown = checkKey;

			render();

			// Main functions
			function addSceneElements()
			{
				// Create the ground
				var groundGeometry = new THREE.BoxGeometry( 50, 50, 0.2 );
				var groundMaterial = new THREE.MeshBasicMaterial( { color: 0x5FB404 } );
				var ground = new THREE.Mesh( groundGeometry, groundMaterial );
				ground.receiveShadow = true;
				scene.add( ground );

				//Add trees
				//(radiusTop, radiusBottom, height)
				var geometryTrunk = new THREE.CylinderGeometry( 0.1, 0.5, 2);
				var materialTrunk = new THREE.MeshBasicMaterial( {color: 0x4d2600} );

				var geometrySphere = new THREE.SphereGeometry(1);
				var materialSphere = new THREE.MeshBasicMaterial( {color: 0x009900} );
				var Z =Â 10;
				var mx=5;
				var my=5;
				for (var i=0;i<20;i++)
				{
					var mx=Math.random()*50;
					var my=Math.random()*50;
					var trunk = new THREE.Mesh( geometryTrunk, materialTrunk );
					trunk.position.x=mx-25;
					trunk.position.y=my-25;
					trunk.rotation.x = Math.PI / 2;
					scene.add( trunk );

					var sphere = new THREE.Mesh( geometrySphere, materialSphere );
					sphere.position.x=mx-25;
					sphere.position.y=my-25;
					sphere.position.setZ(2);
					scene.add( sphere );
					//mx=mx-5;
					//my=my-5;
				}
			}

			function initializeSnake()
			{
				// Create the snake
				var cubeGeometry = new THREE.BoxGeometry( 1, 1, 1 );
				var cubeMaterial = new THREE.MeshPhongMaterial( { color: 0xff0000 } );

				var initialSnakeLength = 3;
				for (var i = 0; i < initialSnakeLength; i++)
				{
					var cube = new THREE.Mesh( cubeGeometry, cubeMaterial );
					cube.position.set(initialSnakeLength-i, 0, 0.5);
					snakeCubeArray.push(cube);
					scene.add(snakeCubeArray[i]);
				}
			}

			function moveSnakeForward()
			{
				// Check if the snake is eating something
				// Increment snake length
				// TODO

				// Put the last piece in the front
				snakeCubeArray.splice(0, 0, snakeCubeArray.pop());

				// Move head in the forward forwardDirection
				snakeCubeArray[0].position.copy(snakeCubeArray[1].position);
				snakeCubeArray[0].position.add(snakeForwardDirection);
			}

			function addLights()
			{
				if(debug == true)
				{
					console.log('test');
				}
				// Ambient light has no direction, it illuminates every object with the same 
				// intensity. If only ambient light is used, no shading effects will occur. 
				var ambientLight = new THREE.AmbientLight(0x101010, 1.0); 
				scene.add(ambientLight);   

				// Directional light has a source and shines in all directions, like the sun. 
				// This behaviour creates shading effects. 
				directionalLight = new THREE.DirectionalLight(0xffffff, 1.0); 
				directionalLight.position.set(5.0, 5.0, 10.0); 
				directionalLight.castShadow = true;
				directionalLight.shadowCameraNear = true;
				directionalLight.shadowCameraVisible = true;
				directionalLight.shadowDarkness = 0.5;
				scene.add(directionalLight);
			}

			function checkKey(e) 
			{
				e = e || window.event;
				var distance = 1;

				if (e.keyCode == '90')
				{
					// z
					if(debug == true)
					{
						console.log('z');
					}
					camera.translateY(-distance);
				}
				else if (e.keyCode == '83')
				{
					// s
					if(debug == true)
					{
						console.log('s');
					}
					camera.translateY(distance);
				}
				else if (e.keyCode == '81')
				{
					// q
					if(debug == true)
					{
						console.log('q');
					}
				      camera.translateX(distance);
				}
				else if (e.keyCode == '68')
				{
					// d
					if(debug == true)
					{
						  console.log('d');
					}
					camera.translateX(-distance);
				}
				else if (e.keyCode == '37')
				{
					// LEFT ARROW
					if(debug == true)
					{
						  console.log('left arrow');
					}
					snakeForwardDirection.set(-1,0,0);
				}
				else if (e.keyCode == '38')
				{
					// UP ARROW
					if(debug == true)
					{
						  console.log('up arrow');
					}
					snakeForwardDirection.set(0,1,0);
				}
				else if (e.keyCode == '39')
				{
					// RIGHT ARROW
					if(debug == true)
					{
						  console.log('right arrow');
					}
					snakeForwardDirection.set(1,0,0);
				}
				else if (e.keyCode == '40')
				{
					// DOWN ARROW
					if(debug == true)
					{
						  console.log('down arrow');
					}
					snakeForwardDirection.set(0,-1,0);
				}
			}

			function render()
			{
				requestAnimationFrame( render );
				elapsedTime += clock.getDelta();
				if( elapsedTime > tickDelta)
				{
					moveSnakeForward();
					elapsedTime = 0.0;
				}
				renderer.render( scene, camera );
			}
		</script>
	</body>
</html>

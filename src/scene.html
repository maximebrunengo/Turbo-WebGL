<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>My first Three.js app</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
		<script src="js/three.min.js"></script>
		<script src="js/lights/AmbientLight.js"></script>
		<script>
			// Global variables
			var snakeCubeArray = [];
			var snakeForwardDirection = new THREE.Vector3(1,0,0);
			var clock = new THREE.Clock(true);
			var elapsedTime = 0;
			var tickDelta = 0.5 // 500ms

			// Debug or not
			var debug = true;

			// Create the scene
			var scene = new THREE.Scene();

			// Add the camera
			var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
			camera.position.z = 10;
			camera.position.y = -7;
			camera.rotation.x = 0.5;

			// Add scene elements
			addSceneElements();

			// Add Snake
			initializeSnake();

			// Add lights
			addLights();

			// Create the WebGL renderer
			var renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );

			// Append the renderer to the body
			document.body.appendChild( renderer.domElement );

			document.onkeydown = checkKey;

			render();

			// Main functions
			function addSceneElements()
			{
				// Create the ground
				var groundGeometry = new THREE.BoxGeometry( 15, 15, 0.2 );
				var groundMaterial = new THREE.MeshBasicMaterial( { color: 0x5FB404 } );
				var ground = new THREE.Mesh( groundGeometry, groundMaterial );
				scene.add( ground );

				//Add trees

				//(radiusTop, radiusBottom, height);
				var geometry = new THREE.CylinderGeometry( 0.1, 0.5, 2); 
				var material = new THREE.MeshBasicMaterial( {color: 0x4d2600} );
				var trunk = new THREE.Mesh( geometry, material );
				trunk.position.setX(2);
				trunk.position.setY(5);
				trunk.rotation.x = 3.14 / 2;
				scene.add( trunk );

				var geometry = new THREE.SphereGeometry(1);
				var material = new THREE.MeshBasicMaterial( {color: 0x006600} );
				var sphere = new THREE.Mesh( geometry, material );
				sphere.position.setX(2);
				sphere.position.setY(5);
				sphere.position.setZ(2);
				scene.add( sphere );
			}

			function initializeSnake()
			{
				// Create the snake
				var cubeGeometry = new THREE.BoxGeometry( 1, 1, 1 );
				var cubeMaterial = new THREE.MeshPhongMaterial( { color: 0xff0000 } );

				var initialSnakeLength = 3;
				for (var i = 0; i < initialSnakeLength; i++)
				{
					var cube = new THREE.Mesh( cubeGeometry, cubeMaterial );
					cube.position.set(initialSnakeLength-i, 0, 0.5);
					snakeCubeArray.push(cube);
					scene.add(snakeCubeArray[i]);
				}
			}

			function moveSnakeForward()
			{
				// Check if the snake is eating something
				// Increment snake length
				// TODO

				// Put the last piece in the front
				snakeCubeArray.splice(0, 0, snakeCubeArray.pop());

				// Move head in the forward forwardDirection
				snakeCubeArray[0].position.copy(snakeCubeArray[1].position);
				snakeCubeArray[0].position.add(snakeForwardDirection);
			}

			function addLights()
			{
				if(debug == true)
				{
					console.log('test');
				}
				var light = new THREE.PointLight( 0xFFFF00 );
				light.position.set( 10, 0, 10 );
				scene.add( light );
			}

			function checkKey(e) 
			{
				e = e || window.event;

				if (e.keyCode == '90')
				{
					// z
					if(debug == true)
					{
						console.log('Z');
					}
					camera.translateZ(1);
				}
				else if (e.keyCode == '83')
				{
					// s
					if(debug == true)
					{
						console.log('S');
					}
					camera.translateZ(-1);
				}
				else if (e.keyCode == '81')
				{
					// q
					if(debug == true)
					{
						console.log('Q');
					}
				      camera.translateX(1);
				}
				else if (e.keyCode == '68')
				{
					// d
					if(debug == true)
					{
						  console.log('D');
					}
					camera.translateX(-1);
				}
				else if (e.keyCode == '37')
				{
					// LEFT ARROW
					if(debug == true)
					{
						  console.log('left arrow');
					}
					snakeForwardDirection.set(-1,0,0);
				}
				else if (e.keyCode == '38')
				{
					// UP ARROW
					if(debug == true)
					{
						  console.log('up arrow');
					}
					snakeForwardDirection.set(0,1,0);
				}
				else if (e.keyCode == '39')
				{
					// RIGHT ARROW
					if(debug == true)
					{
						  console.log('right arrow');
					}
					snakeForwardDirection.set(1,0,0);
				}
				else if (e.keyCode == '40')
				{
					// DOWN ARROW
					if(debug == true)
					{
						  console.log('down arrow');
					}
					snakeForwardDirection.set(0,-1,0);
				}
			}

			function render()
			{
				requestAnimationFrame( render );
				elapsedTime += clock.getDelta();
				if( elapsedTime > tickDelta)
				{
					moveSnakeForward();
					elapsedTime = 0.0;
				}

				renderer.render( scene, camera );
			}
		</script>
	</body>
</html>
